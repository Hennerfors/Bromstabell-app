import streamlit as st

# STEG 1: DIGITALISERAD DATA FR√ÖN DINA PDF-TABELLER
# ----------------------------------------------------
# Datastruktur:
# {
#   'Bana': {
#     (min_l√§ngd, max_l√§ngd): [
#       (min_broms, max_broms, hastighet),
#       ...
#     ],
#     ...
#   }
# }
#
# Not: -1 representerar ingen √∂vre gr√§ns.

HASTIGHETS_DATA = {
    'A': {
        (0, 100): [  # T√•gl√§ngd "-100"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90),
            (73, 85, 100), (86, 99, 110), (100, 118, 120), (119, 138, 130),
            (139, 143, 140), (144, -1, 150)
        ],
        (101, 200): [  # T√•gl√§ngd "101-200"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90),
            (73, 85, 100), (86, 103, 110), (104, 124, 120), (125, 146, 130),
            (147, -1, 140)
        ],
        (201, 300): [  # T√•gl√§ngd "201-300"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90),
            (73, 85, 100), (86, 107, 110), (108, 129, 120), (130, 153, 130),
            (154, -1, 140)
        ],
        (301, 400): [  # T√•gl√§ngd "301-400"
            (0, 60, 60), (61, 68, 70), (69, 72, 80), (73, 74, 90),
            (75, 87, 100), (88, 109, 110), (110, 129, 120), (130, -1, 130)
        ],
        (401, 460): [  # T√•gl√§ngd "401-460"
            (0, 60, 60), (61, 69, 70), (70, 72, 80), (73, 75, 90),
            (76, 90, 100), (91, 109, 110), (110, 132, 120), (133, -1, 130)
        ],
        (461, 520): [  # T√•gl√§ngd "461-520"
            (0, 60, 60), (61, 71, 70), (72, 72, 80), (73, 75, 90),
            (76, 93, 100), (94, 116, 110), (117, 143, 120), (144, -1, 130)
        ],
        (521, 570): [  # T√•gl√§ngd "521-570"
            (0, 60, 60), (61, 72, 70), (73, 75, 80), (76, 78, 90),
            (79, 97, 100), (98, 119, 110), (120, -1, 120)
        ],
        (571, 620): [  # T√•gl√§ngd "571-620"
            (0, 60, 60), (61, 75, 70), (76, 78, 80), (79, 79, 90),
            (80, 100, 100), (101, 129, 110), (130, -1, 120)
        ],
        (621, 670): [  # T√•gl√§ngd "621-670"
            (0, 60, 60), (61, 77, 70), (78, 79, 80), (80, 82, 90),
            (83, 104, 100), (105, 134, 110), (135, -1, 120)
        ],
        (671, 710): [  # T√•gl√§ngd "671-710"
            (0, 60, 40), (61, 62, 50), (63, 64, 60), (65, 79, 70),
            (80, 82, 80), (83, 87, 90), (88, 109, 100), (110, -1, 110)
        ],
        (711, 750): [  # T√•gl√§ngd "711-750"
            (0, 64, 40), (65, 65, 50), (66, 66, 60), (67, 68, 70),
            (69, 82, 80), (83, 87, 90), (88, 90, 100), (91, -1, 110)
        ]
    },
    'B': {
        (0, 100): [  # T√•gl√§ngd "-100"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90), (73, 85, 100),
            (86, 99, 110), (100, 118, 120), (119, 121, 130), (122, 124, 140),
            (125, 134, 150), (135, 143, 160), (144, -1, 170)
        ],
        (101, 200): [  # T√•gl√§ngd "101-200"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90), (73, 85, 100),
            (86, 103, 110), (104, 124, 120), (125, 126, 130), (127, 137, 140),
            (138, 146, 150), (147, -1, 160)
        ],
        (201, 300): [  # T√•gl√§ngd "201-300"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90), (73, 85, 100),
            (86, 107, 110), (108, 129, 120), (130, 140, 140), (141, 150, 150),
            (151, -1, 160)
        ],
        (301, 400): [  # T√•gl√§ngd "301-400"
            (0, 60, 60), (61, 68, 70), (69, 72, 80), (73, 74, 90), (75, 87, 100),
            (88, 109, 110), (110, 129, 120), (130, 132, 130), (133, 143, 140),
            (144, 153, 150), (154, -1, 160)
        ],
        (401, 460): [  # T√•gl√§ngd "401-460"
            (0, 60, 60), (61, 69, 70), (70, 72, 80), (73, 75, 90), (76, 90, 100),
            (91, 109, 110), (110, 132, 120), (133, 134, 130), (135, 136, 140),
            (137, 147, 150), (148, -1, 160)
        ],
        (461, 520): [  # T√•gl√§ngd "461-520"
            (0, 60, 60), (61, 71, 70), (72, 72, 80), (73, 75, 90), (76, 93, 100),
            (94, 116, 110), (117, 143, 120), (144, 150, 140), (151, -1, 150)
        ],
        (521, 570): [  # T√•gl√§ngd "521-570"
            (0, 60, 60), (61, 72, 70), (73, 75, 80), (76, 78, 90), (79, 97, 100),
            (98, 119, 110), (120, -1, 120)
        ],
        (571, 620): [  # T√•gl√§ngd "571-620"
            (0, 60, 60), (61, 75, 70), (76, 78, 80), (79, 79, 90),
            (80, 100, 100), (101, 129, 110), (130, -1, 120)
        ],
        (621, 670): [  # T√•gl√§ngd "621-670"
            (0, 60, 60), (61, 77, 70), (78, 79, 80), (80, 82, 90),
            (83, 104, 100), (105, 134, 110), (135, -1, 120)
        ],
        (671, 710): [  # T√•gl√§ngd "671-710"
            (0, 60, 40), (61, 62, 50), (63, 64, 60), (65, 79, 70),
            (80, 82, 80), (83, 87, 90), (88, 109, 100), (110, -1, 110)
        ],
        (711, 750): [  # T√•gl√§ngd "711-750"
            (0, 64, 40), (65, 65, 50), (66, 66, 60), (67, 68, 70),
            (69, 82, 80), (83, 87, 90), (88, 90, 100), (91, -1, 110)
        ]
    },
    'C': {
        (0, 100): [  # T√•gl√§ngd "-100"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90), (73, 97, 100),
            (98, 112, 110), (113, 121, 120), (122, 124, 130), (125, 134, 140),
            (135, 143, 150), (144, -1, 160)
        ],
        (101, 200): [  # T√•gl√§ngd "101-200"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90), (73, 99, 100),
            (100, 115, 110), (116, 124, 120), (125, 126, 130), (127, 137, 140),
            (138, 146, 150), (147, -1, 160)
        ],
        (201, 300): [  # T√•gl√§ngd "201-300"
            (0, 60, 60), (61, 66, 70), (67, 71, 80), (72, 72, 90), (73, 102, 100),
            (103, 118, 110), (119, 126, 120), (127, 129, 130), (130, 140, 140),
            (141, 150, 150), (151, -1, 160)
        ],
        (301, 400): [  # T√•gl√§ngd "301-400"
            (0, 60, 60), (61, 68, 70), (69, 72, 80), (73, 74, 90), (75, 103, 100),
            (104, 119, 110), (120, 129, 120), (130, 132, 130), (133, 143, 140),
            (144, 153, 150), (154, -1, 160)
        ],
        (401, 460): [  # T√•gl√§ngd "401-460"
            (0, 60, 60), (61, 69, 70), (70, 72, 80), (73, 75, 90), (76, 106, 100),
            (107, 122, 110), (123, 134, 120), (135, 136, 130), (137, 147, 140),
            (148, -1, 150)
        ],
        (461, 520): [  # T√•gl√§ngd "461-520"
            (0, 60, 60), (61, 71, 70), (72, 72, 80), (73, 75, 90), (76, 107, 100),
            (108, 126, 110), (127, 137, 120), (138, 140, 130), (141, 150, 140),
            (151, -1, 150)
        ],
        (521, 570): [  # T√•gl√§ngd "521-570"
            (0, 60, 60), (61, 72, 70), (73, 75, 80), (76, 78, 90), (79, 111, 100),
            (112, 129, 110), (130, 143, 120), (144, -1, 130)
        ],
        (571, 620): [  # T√•gl√§ngd "571-620"
            (0, 60, 60), (61, 75, 70), (76, 78, 80), (79, 79, 90), (80, 113, 100),
            (114, 134, 110), (135, 150, 120), (151, -1, 130)
        ],
        (621, 670): [  # T√•gl√§ngd "621-670"
            (0, 60, 60), (61, 77, 70), (78, 79, 80), (80, 82, 90), (83, 116, 100),
            (117, 141, 110), (142, -1, 120)
        ],
        (671, 710): [  # T√•gl√§ngd "671-710"
            (0, 60, 40), (61, 62, 50), (63, 64, 60), (65, 79, 70),
            (80, 82, 80), (83, 87, 90), (88, -1, 100)
        ],
        (711, 750): [  # T√•gl√§ngd "711-750"
            (0, 64, 40), (65, 65, 50), (66, 66, 60), (67, 68, 70),
            (69, 82, 80), (83, 87, 90), (88, 90, 100), (91, -1, 110)
        ]
    },
    'E': {
        (0, 100): [
            (0, 57, 40), (58, 61, 50), (62, 66, 60), (67, 70, 70), (71, 75, 80),
            (76, 80, 90), (81, 85, 100), (86, 90, 110), (91, 95, 120), (96, -1, 130)
        ],
        (101, 200): [
            (0, 57, 40), (58, 62, 50), (63, 67, 60), (68, 72, 70), (73, 77, 80),
            (78, 82, 90), (83, 87, 100), (88, 92, 110), (93, 97, 120), (98, -1, 130)
        ],
        (201, 300): [
            (0, 57, 40), (58, 58, 50), (59, 63, 60), (64, 68, 70), (69, 73, 80),
            (74, 78, 90), (79, 83, 100), (84, 88, 110), (89, 93, 120), (94, 98, 130),
            (99, -1, 140)
        ],
        (301, 400): [
            (0, 57, 40), (58, 59, 50), (60, 64, 60), (65, 69, 70), (70, 74, 80),
            (75, 80, 90), (81, 85, 100), (86, 90, 110), (91, 95, 120), (96, 100, 130),
            (101, -1, 140)
        ],
        (401, 460): [
            (0, 57, 40), (58, 59, 50), (60, 65, 60), (66, 70, 70), (71, 75, 80),
            (76, 81, 90), (82, 86, 100), (87, 91, 110), (92, 97, 120), (98, 101, 130),
            (102, -1, 140)
        ],
        (461, 520): [
            (0, 57, 40), (58, 60, 50), (61, 65, 60), (66, 71, 70), (72, 76, 80),
            (77, 82, 90), (83, 87, 100), (88, 92, 110), (93, 98, 120), (99, 103, 130),
            (104, -1, 140)
        ],
        (521, 570): [
            (0, 57, 40), (58, 60, 50), (61, 66, 60), (67, 71, 70), (72, 77, 80),
            (78, 82, 90), (83, 88, 100), (89, 93, 110), (94, 99, 120), (100, 104, 130),
            (105, -1, 140)
        ],
        (571, 620): [
            (0, 57, 40), (58, 61, 50), (62, 67, 60), (68, 72, 70), (73, 78, 80),
            (79, 83, 90), (84, 89, 100), (90, 94, 110), (95, 100, 120), (101, 105, 130),
            (106, -1, 140)
        ],
        (621, 670): [
            (0, 57, 40), (58, 61, 50), (62, 67, 60), (68, 73, 70),
            (74, 78, 80), (79, 84, 90), (85, 90, 100), (91, 95, 110), (96, 101, 120),
            (102, 106, 130), (107, -1, 140)
        ],
        (671, 710): [
            (0, 57, 40), (58, 62, 50), (63, 68, 60), (69, 73, 70),
            (74, 79, 80), (80, 85, 90), (86, 90, 100), (91, 96, 110), (97, 101, 120),
            (102, 107, 130), (108, -1, 140)
        ],
        (711, 750): [
            (0, 57, 40), (58, 62, 50), (63, 68, 60), (69, 74, 70),
            (75, 80, 80), (81, 86, 90), (87, 92, 100), (93, 98, 110), (99, 104, 120),
            (105, 109, 130), (110, -1, 140)
        ],
        (751, 780): [
            (0, 57, 40), (58, 59, 50), (60, 63, 60), (64, 69, 70), (70, 76, 80),
            (77, 82, 90), (83, 89, 100), (90, 95, 110), (96, 101, 120), (102, 107, 130),
            (108, 112, 140), (113, -1, 150)
        ],
        (781, 810): [
            (0, 57, 40), (58, 60, 50), (61, 64, 60), (65, 71, 70), (72, 78, 80),
            (79, 85, 90), (86, 92, 100), (93, 99, 110), (100, 104, 120), (105, 110, 130),
            (111, 116, 140), (117, -1, 150)
        ],
        (811, 850): [
            (0, 57, 40), (58, 58, 50), (59, 67, 60), (68, 75, 70),
            (76, 82, 80), (83, 89, 90), (90, 97, 100), (98, 103, 110), (104, 109, 120),
            (110, 116, 130), (117, 122, 140), (123, -1, 150)
        ],
    },
    'EM': {
        (0, 400): [  # G√§ller f√∂r intervallen -100, 101-200, 201-300, 301-400
            (0, 29, 40), (30, 30, 50), (31, 33, 60), (34, 37, 70), (38, 41, 80),
            (42, 45, 90), (46, 49, 100), (50, 52, 110), (53, 58, 120), (59, 63, 130),
            (64, 67, 140), (68, 73, 150), (74, 78, 160), (79, 83, 170),
            (84, 88, 180), (89, 93, 190), (94, -1, 200)
        ],
        (401, 460): [
            (0, 29, 40), (30, 30, 50), (31, 33, 60), (34, 37, 70), (38, 41, 80),
            (42, 46, 90), (47, 49, 100), (50, 53, 110), (54, 58, 120), (59, 63, 130),
            (64, 68, 140), (69, 74, 150), (75, 79, 160), (80, 84, 170),
            (85, 89, 180), (90, 94, 190), (95, -1, 200)
        ],
        (461, 520): [
            (0, 29, 40), (30, 30, 50), (31, 34, 60), (35, 37, 70), (38, 42, 80),
            (43, 46, 90), (47, 50, 100), (51, 54, 110), (55, 59, 120), (60, 64, 130),
            (65, 69, 140), (70, 75, 150), (76, 80, 160), (81, 85, 170),
            (86, 90, 180), (91, 96, 190), (97, -1, 200)
        ],
        (521, 570): [
            (0, 29, 40), (30, 31, 50), (32, 34, 60), (35, 38, 70), (39, 42, 80),
            (43, 47, 90), (48, 51, 100), (52, 54, 110), (55, 60, 120), (61, 65, 130),
            (66, 70, 140), (71, 75, 150), (76, 81, 160), (82, 86, 170),
            (87, 91, 180), (92, 97, 190), (98, -1, 200)
        ],
        (571, 620): [
            (0, 29, 40), (30, 31, 50), (32, 35, 60), (36, 38, 70), (39, 43, 80),
            (44, 47, 90), (48, 51, 100), (52, 55, 110), (56, 60, 120), (61, 65, 130),
            (66, 71, 140), (72, 76, 150), (77, 82, 160), (83, 87, 170),
            (88, 92, 180), (93, 98, 190), (99, -1, 200)
        ],
        (621, 670): [
            (0, 29, 40), (30, 31, 50), (32, 35, 60), (36, 39, 70), (40, 43, 80),
            (44, 48, 90), (49, 52, 100), (53, 56, 110), (57, 61, 120), (62, 66, 130),
            (67, 72, 140), (73, 77, 150), (78, 83, 160), (84, 88, 170),
            (89, 94, 180), (95, 99, 190), (100, -1, 200)
        ],
        (671, 710): [
            (0, 29, 40), (30, 31, 50), (32, 35, 60), (36, 39, 70), (40, 43, 80),
            (44, 48, 90), (49, 52, 100), (53, 56, 110), (57, 61, 120), (62, 67, 130),
            (68, 73, 140), (74, 79, 150), (80, 85, 160), (86, 91, 170),
            (92, 97, 180), (98, 103, 190), (104, -1, 200)
        ],
        (711, 750): [
            (0, 29, 40), (30, 32, 50), (33, 36, 60), (37, 39, 70), (40, 44, 80),
            (45, 49, 90), (50, 53, 100), (54, 56, 110), (57, 63, 120), (64, 70, 130),
            (71, 76, 140), (77, 82, 150), (83, 89, 160), (90, 95, 170),
            (96, 101, 180), (102, 106, 190), (107, -1, 200)
        ],
        (751, 780): [
            (0, 29, 40), (30, 32, 50), (33, 36, 60), (37, 40, 70), (41, 45, 80),
            (46, 50, 90), (51, 54, 100), (55, 58, 110), (59, 65, 120), (66, 71, 130),
            (72, 78, 140), (79, 85, 150), (86, 91, 160), (92, 98, 170),
            (99, 103, 180), (104, 109, 190), (110, -1, 200)
        ],
        (781, 810): [
            (0, 29, 40), (30, 33, 50), (34, 37, 60), (38, 41, 70), (42, 46, 80),
            (47, 51, 90), (52, 55, 100), (56, 60, 110), (61, 67, 120), (68, 74, 130),
            (75, 80, 140), (81, 87, 150), (88, 94, 160), (95, 100, 170),
            (101, 106, 180), (107, 112, 190), (113, -1, 200)
        ],
        (811, 850): [
            (0, 29, 40), (30, 30, 50), (31, 34, 60), (35, 38, 70), (39, 43, 80),
            (44, 47, 90), (48, 53, 100), (54, 57, 110), (58, 69, 120),
            (70, 77, 130), (78, 84, 140), (85, 91, 150), (92, 98, 160),
            (99, 104, 170), (105, 111, 180), (112, 117, 190), (118, -1, 200)
        ],
        (851, 900): [
            (0, 29, 40), (30, 31, 50), (32, 36, 60), (37, 40, 70), (41, 45, 80),
            (46, 50, 90), (51, 56, 100), (57, 60, 110), (61, 73, 120),
            (74, 81, 130), (82, 89, 140), (90, 97, 150), (98, 103, 160),
            (104, 110, 170), (111, 117, 180), (118, 123, 190), (124, -1, 200)
        ]
    }
}


# OBS: Ovanst√•ende data √§r en f√∂rkortad version f√∂r att h√•lla koden l√§sbar.
# En fullst√§ndig applikation skulle ha all data fr√•n alla tabeller inmatad.


# STEG 2: S√ñKFUNKTION
# --------------------
def hitta_max_hastighet(bana, t√•gl√§ngd, bromsprocent):
    """
    Hittar den maximala hastigheten genom att sl√• upp i HASTIGHETS_DATA.
    """
    if bana not in HASTIGHETS_DATA:
        return "Ok√§nd bana vald."

    # Hitta r√§tt l√§ngdintervall
    valt_l√§ngdintervall = None
    for (min_l√§ngd, max_l√§ngd), data in HASTIGHETS_DATA[bana].items():
        if min_l√§ngd <= t√•gl√§ngd <= max_l√§ngd:
            valt_l√§ngdintervall = data
            break

    if not valt_l√§ngdintervall:
        return "T√•gl√§ngden finns inte med i tabellen f√∂r den valda banan."

    # Hitta r√§tt hastighet baserat p√• bromsprocent
    for min_broms, max_broms, hastighet in valt_l√§ngdintervall:
        # Hantera "o√§ndligt" intervall (d√§r vi anv√§nde -1)
        if max_broms == -1 and bromsprocent >= min_broms:
            return hastighet
        # Hantera vanliga intervall
        if min_broms <= bromsprocent <= max_broms:
            return hastighet

    return "Ingen hastighet hittades f√∂r angiven bromsprocent. Den kan vara f√∂r l√•g."


# STEG 3: WEBBAPPLIKATION MED STREAMLIT
# ----------------------------------------
st.set_page_config(page_title="Hastighetskollen", page_icon="üöÑ")
col1, col2, col3 = st.columns([1, 2, 1])
with col2:
    st.image("OnRail.png", width=300)
st.title('üöÑ Hastighetskollen')
st.write("Ett verktyg f√∂r att hitta h√∂gsta till√•tna hastighet baserat p√• indata fr√•n Trafikverkets tabeller.")
# 1. DEFINIERA en funktion f√∂r din dialogruta
#    Anv√§nd "@st.dialog()" som en "dekorat√∂r" ovanf√∂r funktionen.
@st.dialog("√ñversiktskarta")
def visa_karta_dialog():
    st.subheader("Karta √∂ver bandelar A, B, C, E och EM")
    st.image("Karta.png")


# 2. SKAPA knappen som anropar funktionen
#    Detta √§r den del du placerar d√§r du vill att knappen ska synas.

if st.button("üó∫Ô∏è √ñversiktskarta Bromstabeller"):
    visa_karta_dialog() # Anropa funktionen n√§r knappen klickas


# V√§lj bana
bana_vald = st.selectbox(
    'V√§lj bana:',
    options=list(HASTIGHETS_DATA.keys())
)

# Mata in v√§rden
kol1, kol2 = st.columns(2)
with kol1:
    t√•gl√§ngd_inmatad = st.number_input(
        'Ange t√•gl√§ngd (meter):',
        min_value=0,
        max_value=1500,
        value=350,
        step=10,
        help="Ange t√•gets totala l√§ngd i meter."
    )

with kol2:
    bromsprocent_inmatad = st.number_input(
        'Ange tillg√§nglig bromsprocent:',
        min_value=0,
        max_value=200,
        value=100,
        step=1,
        help="Ange den tillg√§ngliga bromsprocenten f√∂r t√•gs√§ttet."
    )

# Knapp och resultat
if st.button('Hitta h√∂gsta till√•tna hastighet'):
    resultat = hitta_max_hastighet(bana_vald, t√•gl√§ngd_inmatad, bromsprocent_inmatad)

    st.subheader('Resultat')
    if isinstance(resultat, int):
        st.metric(
            label=f"H√∂gsta till√•tna hastighet (sth)",
            value=f"{resultat} km/h"
        )
        st.success(f"Resultatet √§r baserat p√• tabellen f√∂r bana **{bana_vald}**.")
    else:
        st.error(resultat)
      
